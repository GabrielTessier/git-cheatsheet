#+author: Gabriel TESSIER

* Getting Started
** Start a new repo
=git init=

** Clone an existing repo
=git clone <url>=

* Prepare to Commit
** Add untracked file or unstaged changes
=git add <file>=

** Add all untracked files and unstaged changes
=git add -A=

** Choose which parts of a file to stage
=git add -p=

** Tell Git to forget about a file without deleting it
=git rm --cached <file>=

** Unstage one file
=git reset <file>=

** Unstage everything
=git reset=

** Check what you added
=git status=

* Make Commits
** Open text editor to write message :
=git commit=

** Inline message in the commande :
=git commit -m "message"=

** Commit all unstaged changes :
=git commit -am "message"=

* Move Between Branches
** Switch branches
=git switch <name=
=git checkout <name>=

** Create a branch
=git switch -c <name>=
=git checkout -b <name>=

** List branches
=git branch=

** List branches by most recently committed to
git branch --sort=-committerdate

** Delete a branch
=git branch -d <name>=

** Force delete a branch
=git branch -D <name>=

* Diff Staged/Unstaged Changes
** Diff all staged and unstaged changes
=git diff HEAD=

** Diff just staged changes
=git diff -​-staged=

** Diff just unstaged changes
=git diff=

* Diff Commits
** Show diff between a commit and its parent
=git show <commit>=

** Diff two commits
=git diff <commit> <commit>=

** Diff one file since a commit
=git diff <commit> <file>=

** Show a summary of a diff
=git diff <commit> -​-stat=
=git show <commit> -​-stat=

* Discard Your Changes
** Delete unstaged changes to one file
=git restore <file>=
=git checkout <file>=

** Delete all staged and unstaged changes to one file
=git restore -​-staged -​-worktree <file>=
=git checkout HEAD <file>=

** Delete all staged and unstaged changes
=git reset -​-hard=

** Delete untracked files
=git clean=

** 'Stash' all staged ans unstaged changes
=git stash=

* Edit History
** "Undo" the most recent commit (keep your working directory the same)
=git reset HEAD^=

** Interactive Rebase
Squash the last 5 commits into one :
=git rebase -i HEAD~6=
Then change "pick" to "fixup" for any commit you want to combine with the previous one

** Undo a failed rebase
=git reflog BRANCHNAME=
Then manually find the right commit ID in the reflog, then run :
=git reset -​-hard <commit>=

** Change a commit message (or add a file you forgot)
=git commit -​-amend=

* Combine Diverged Branches
** Combine with rebase
#+BEGIN_SRC
  git switch banana
  git rebase main
#+END_SRC

*** Before :
#+begin_src mermaid :file git-rebase-before.svg :theme dark
gitGraph
    commit id:"A"
    commit id:"B"

    branch banana
    commit id:"D"
    commit id:"E"

    checkout main
    commit id:"C"
#+end_src

#+RESULTS:
[[file:git-rebase-before.svg]]

*** After :
lost is not a real branch (all commits in lost are lost)

#+begin_src mermaid :file git-rebase-after.svg :theme dark
gitGraph
    commit id:"A"
    commit id:"B"

    branch lost
    commit id:"D" type:REVERSE
    commit id:"E" type:REVERSE

    checkout main
    commit id:"C"

    branch banana
    commit id:"D'"
    commit id:"E'"
#+end_src

#+RESULTS:
[[file:git-rebase-after.svg]]

** Combine with merge
#+BEGIN_SRC
  git switch main
  git merge banana
#+END_SRC

*** Before :
#+begin_src mermaid :file git-merge-before.svg :theme dark
gitGraph
    commit id:"A"
    commit id:"B"

    branch banana
    commit id:"D"
    commit id:"E"

    checkout main
    commit id:"C"
#+end_src

#+RESULTS:
[[file:git-merge-before.svg]]

*** After :
#+begin_src mermaid :file git-merge-after.svg :theme dark
gitGraph
    commit id:"A"
    commit id:"B"

    branch banana
    commit id:"D"
    commit id:"E"

    checkout main
    commit id:"C"
    merge banana
#+end_src

#+RESULTS:
[[file:git-merge-after.svg]]

** Combine with squash merge
#+BEGIN_SRC
  git switch main
  git merge -​-squash banana
  git commit
#+END_SRC

*** Before :
#+begin_src mermaid :file git-squash-merge-before.svg :theme dark
gitGraph
    commit id:"A"
    commit id:"B"

    branch banana
    commit id:"D"
    commit id:"E"

    checkout main
    commit id:"C"
#+end_src

#+RESULTS:
[[file:git-squash-merge-before.svg]]

*** After :
#+begin_src mermaid :file git-squash-merge-after.svg :theme dark
gitGraph
    commit id:"A"
    commit id:"B"

    branch banana
    commit id:"D"
    commit id:"E"

    checkout main
    commit id:"C"
    commit id:"D E"
#+end_src

#+RESULTS:
[[file:git-squash-merge-after.svg]]

** Bring a branch up to date with another branch (aka "fast-forward merge")
#+BEGIN_SRC
  git switch main
  git merge banana
#+END_SRC

** Copy one commit onto the current branch
=git cherry-pick <commit>=

*** Before :
#+begin_src mermaid :file git-cherry-pick-before.svg :theme dark
gitGraph
    commit id:"A"
    commit id:"B"

    branch banana
    commit id:"D"
    commit id:"E"

    checkout main
    commit id:"C"
#+end_src

#+RESULTS:
[[file:git-cherry-pick-before.svg]]

*** After :
#+begin_src mermaid :file git-cherry-pick-after.svg :theme dark
gitGraph
    commit id:"A"
    commit id:"B"

    branch banana
    commit id:"D"
    commit id:"E"

    checkout main
    commit id:"C"
    commit id:"D'"
#+end_src

#+RESULTS:
[[file:git-cherry-pick-after.svg]]

* Restore an Old File
** Get the version of a file from another commit
=git checkout <commit> <file>=
=git restore <file> -​-source <commit>=

* Add a Remote
=git remote add <name> <url>=

* Push Your Changes
** Push the ~main~ branch to the remote ~origin~
=git push origin main=

** Push the current branch to its remote "tracking branch"
=git push=

** Push a branch that you've never pushed before
=git push -u origin <name>=

** Force push
=git push -​-force-with-lease=

** Push tags
=git push -​-tags=

* Pull Changes
** Fetch changes (but don't change any of your local branches)
=git fetch origin main=

** Fetch changes and then rebase your current branch
=git pull -​-rebase=

** Fetch changes and then merge them into your current branch
=git pull origin main=
=git pull=

* Filter-branch
** Removes a file from all commits
#+BEGIN_SRC bash
  git filter-branch --force --index-filter \
      "git rm --cached --ignore-unmatch <FILE_NAME>" \
      --prune-empty --tag-name-filter cat -- --all
#+END_SRC

** Removes a folder from all commits
#+BEGIN_SRC bash
  git filter-branch --force --index-filter \
      "git rm --cached --ignore-unmatch -r <FOLDER_NAME>" \
      --prune-empty --tag-name-filter cat -- --all
#+END_SRC

** Sign all commits
#+BEGIN_SRC bash
  git filter-branch -f --commit-filter 'git commit-tree -S "$@";' -- --all
#+END_SRC
